<!-- templates/billing/form.html -->
{% extends "base.html" %} {% block content %}
<h2 class="text-2xl font-semibold mb-4">Create Bill</h2>

<form method="POST" class="bg-white p-6 rounded shadow-md max-w-4xl mx-auto">
  <!-- Bill Info -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
    <div>
      <label class="block text-gray-700">Patient</label>
      <select
        name="patient_id"
        class="w-full border border-gray-300 p-2 rounded"
        required
      >
        <option value="">Select Patient</option>
        {% for p in patients %}
        <option value="{{ p.patient_id }}">{{ p.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block text-gray-700">Related Appointment (Optional)</label>
      <select
        name="appointment_id"
        class="w-full border border-gray-300 p-2 rounded"
      >
        <option value="">None</option>
        {% for a in appointments %}
        <option value="{{ a.appointment_id }}">
          {{ a.date_time.strftime('%Y-%m-%d %H:%M') }} - {{ a.doctor.name }}
        </option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block text-gray-700">Total Amount ($)</label>
      <input
        type="number"
        name="total_amount"
        step="0.01"
        class="w-full border border-gray-300 p-2 rounded"
        required
      />
    </div>
    <div>
      <label class="block text-gray-700">Status</label>
      <select
        name="status"
        class="w-full border border-gray-300 p-2 rounded"
        required
      >
        <option value="Unpaid">Unpaid</option>
        <option value="Paid">Paid</option>
      </select>
    </div>
  </div>

  <!-- Bill Items -->
  <h3 class="text-xl font-medium mt-8 mb-4">Bill Items</h3>
  <div id="items-container">
    <div class="flex gap-2 mb-2">
      <input
        type="text"
        name="item_description"
        placeholder="e.g., Consultation"
        class="flex-1 border border-gray-300 p-2 rounded"
      />
      <input
        type="number"
        name="item_amount"
        step="0.01"
        placeholder="Amount"
        class="w-32 border border-gray-300 p-2 rounded"
      />
      <button
        type="button"
        onclick="addItem()"
        class="bg-gray-500 text-white px-3 py-2 rounded hover:bg-gray-600"
      >
        +
      </button>
    </div>
  </div>

  <button
    type="submit"
    class="bg-purple-500 text-white px-6 py-2 rounded hover:bg-purple-600 mt-6"
  >
    Save Bill
  </button>
</form>

<script>
  function addItem() {
    const container = document.getElementById("items-container");
    const item = document.createElement("div");
    item.className = "flex gap-2 mb-2";
    item.innerHTML = `
    <input type="text" name="item_description" placeholder="e.g., Blood Test" class="flex-1 border border-gray-300 p-2 rounded">
    <input type="number" name="item_amount" step="0.01" placeholder="Amount" class="w-32 border border-gray-300 p-2 rounded">
    <button type="button" onclick="this.parentElement.remove()" class="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600">âˆ’</button>
  `;
    container.appendChild(item);
  }
</script>
{% endblock %}
